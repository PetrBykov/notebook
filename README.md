## API записной книжки
### Описание
Над записной книжкой можно проводить следующие операции:
- Постраничный просмотр записей
- Просмотр конкретной записи по идентификатору (без фото)
- Просмотр фото конткретной записи по идентификатору записи. Вынесено в отдельную операцию, т.к.:  
1. Их не всегда нужно получать, если речь идет об обычном просмотре сведений о записях или одной записи. Фото весят больше чем текст и если выдавать фото лишний раз, они могут нагрузить сервер, трафик, и может быть чревато большим временем ожидания для клиента;  
2. Если API используется для одностраничного сайта, то фото можно встраивать в HTML как раз по этой отдельной операции.
- Создание записи
- Изменение конкретной записи
- Удаление конретной записи
### Использовались для реализации
- Фреймворк Laravel
- Xdebug для отладки
- Плагин MIME Tools в Notepad++ для ручного кодирования в base64
- Postman для создания POST-запросов во время отладки

### Описание API
- Постраничный просмотр  
GET v1/notebook/count/{count}/page/{page}  
, где {count} - запрашиваемое число элементов на странице; {page} - запрашиваемая страница
- Создание новой записи  
POST v1/notebook/  
Должен быть загловок "Accept: application/json", для возврата корректного ответа   
В теле запроса нужно передавать JSON со следующими полями:
<table>
    <tr>
        <th>Имя</th>
        <th>Описание</th>
        <th>Требования</th>
   </tr>
   <tr>
        <td>fullName</td>
        <td>Полное имя</td>
        <td>Обязательное, должно быть не пустым</td>
    </tr>
    <tr>
        <td>company</td>
        <td>Компания</td>
        <td></td>
    </tr>
    <tr>
        <td>phone</td>
        <td>Телефон</td>
        <td>Обязательное, должно быть не пустым, иметь 11 цифр с не обязательным символом "+" в начале  </td>
    </tr>
    <tr>
        <td>email</td>
        <td>Электронная почта</td>
        <td>Обязательное, должно быть не пустым, должно быть валидной почтой</td>
    </tr>
    <tr>
        <td>dateOfBirth</td>
        <td>Дата рождения </td>
        <td></td>
    </tr>
    <tr>
        <td>photoAvailable</td>
        <td>Есть фото</td>
        <td>Обязательное, должно быть не пустым логическим значением</td>
    </tr>
    <tr>
        <td>photoType</td>
        <td>Тип фото </td>
        <td>Обязательное, если photoAvailable указан как true, может принимать значения 'image/png' или 'image/jpeg'</td>
    </tr>
    <tr>
        <td>photoContent</td>
        <td>Содержимое фото</td>
        <td>Обязательное, если photoAvailable указан как true, должно быть содержимым фото, закодированным в base64</td>
    </tr>
</table>

- Просмотр записи  
GET v1/notebook/id{id}  
, где {id} - идентификатор записи  
Если запись не найдена, возвращает 404 с сообщением о том, что запись не найдена, в JSON  
Если записать есть, возвращает 200 и JSON со следующими полями:  
<table>
    <tr>
        <th>Имя</th>
        <th>Описание</th>
   </tr>
   <tr>
        <td>fullName</td>
        <td>Полное имя</td>
    </tr>
    <tr>
        <td>company</td>
        <td>Компания</td>
    </tr>
    <tr>
        <td>phone</td>
        <td>Телефон</td>
    </tr>
    <tr>
        <td>email</td>
        <td>Электронная почта</td>
    </tr>
    <tr>
        <td>dateOfBirth</td>
        <td>Дата рождения </td>
    </tr>
    <tr>
        <td>photoAvailable</td>
        <td>Есть фото</td>
    </tr>
</table>

- Просмотр фото у записи  
GET v1/notebook/id{id}/getPhoto  
, где {id} - идентификатор записи  
Если фото есть, возращает заголовок Content-Type с MIME типом фото и содержимое фото в теле ответа  
Если фото нет, возвращает 404 с JSON, что фото нет  
- Изменение конкретной записи  
POST v1/notebook/id{id}  
, где {id} - идентификатор записи  
Должен быть загловок "Accept: application/json", для возврата корректного ответа  
В теле запроса должен быть JSON. Возможные поля:

<table>
    <tr>
        <th>Имя</th>
        <th>Описание</th>
        <th>Требования</th>
   </tr>
   <tr>
        <td>fullName</td>
        <td>Полное имя</td>
        <td>Если указывается, должно быть не пустым</td>
    </tr>
    <tr>
        <td>company</td>
        <td>Компания</td>
        <td></td>
    </tr>
    <tr>
        <td>phone</td>
        <td>Телефон</td>
        <td>Если указывается, должно быть не пустым, иметь 11 цифр с не обязательным символом "+" в начале</td>
    </tr>
    <tr>
        <td>email</td>
        <td>Электронная почта</td>
        <td>Если указывается, должно быть не пустым, должно быть валидной почтой</td>
    </tr>
    <tr>
        <td>dateOfBirth</td>
        <td>Дата рождения </td>
        <td></td>
    </tr>
    <tr>
        <td>photoAvailable</td>
        <td>Есть фото</td>
        <td>Если указывается, должно быть не пустым логическим значением</td>
    </tr>
    <tr>
        <td>photoType</td>
        <td>Тип фото </td>
        <td>Обязательное, если photoAvailable указан как true, может принимать значения 'image/png' или 'image/jpeg'</td>
    </tr>
    <tr>
        <td>photoContent</td>
        <td>Содержимое фото</td>
        <td>Обязательное, если photoAvailable указан как true, должно быть содержимым фото, закодированным в base64</td>
    </tr>
</table>

- Удаление записи  
DELETE v1/notebook/id{id}  
, где {id} - идентификатор записи  
Если успешно удален, возвращает 200 с сообщеем об успехе в JSON  
Если запись не найдена, возвращает 404 с сообщением о том, что запись не найдена, в JSON  
### Тестирование
Использовались автоматические тесты, так и ручные  
Автоматические тесты (код tests\Feature\notebookTest.php):  
- Проверка корректности ответов на запрос на получение фото.  
Проверяется, что мы получаем корректный ответ на запросы на получение фото у всех, кого должны получить фото, и у тех, у кого не должны получить.  
1) Из базы данных суммируются все, у кого фото есть, и все, у кого фото нет
2) Делаются запросы по API на получение фото от каждой записи. Параллельно ведется счетчик успехов получения фото и неудач (не найдено)
3) Если количество успехов совпадает с количеством тех, у кого есть фото, и количество неудач с количеством тех, у кого нет фото, то тест пройден.

- Проверка корректности отправляемых данных по API  
1) Делаем новую запись со всех полями (обязательными и необязательными)
2) Извлекаем данные
3) Проверяем, что данные сходятся

- Проверка работы валидации новых записей
1) Отправляем все возможные варианты, когда одно из обязательных полей отсутствует
2) Отправляем запись, у которой поле "Есть фото" (photoAvailable) равно false
и не указаны остальные параметры, связанные с фото (photoType, photoContent).
Такая запись должна считатся валидированной
3) Отправляем запись, котороый поле "Есть фото" (photoAvailable) равно true
и не указаны остальные параметры, связанные с фото (photoType, photoContent).
Такая запись НЕ должна считаться валидированной  
<br>
Ручное тестирование:  

- Проверка коррекности пагинации при запросе постраничного списка записей
Проверял вручную, вводя значения невалидные текстовые, а не цифровые значения count и page. Возвращал ошибку  
Вводил валидные значения. Полученные значения сверял с базой данных

- Проверка просмотра фото у записей в HTML тегах
Создал файл &lt;img src="http://127.0.0.1:8000/api/v1/notebook/id115/getPhoto">  
И открыл через браузер, убедился, что показыват фото в браузере (у записи 115 было фото в базе)
